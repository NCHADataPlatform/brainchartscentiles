[
  {
    "objectID": "calibration_accuracy.html",
    "href": "calibration_accuracy.html",
    "title": "BrainChart calibration - assessing accuracy of centile method",
    "section": "",
    "text": "This tutorial demonstrates how to assess the accuracy of the proposed centile-informed calibration compared to the original Braincharts’ method on small samples on the HBN dataset. The first thing to do is source the script that loads and performs the original calibration:\n\nsource('calibration_example_hbn.R')",
    "crumbs": [
      "BrainChart calibration - assessing accuracy of centile method"
    ]
  },
  {
    "objectID": "calibration_accuracy.html#calibration-of-full-fake-sample",
    "href": "calibration_accuracy.html#calibration-of-full-fake-sample",
    "title": "BrainChart calibration - assessing accuracy of centile method",
    "section": "Calibration of full fake sample",
    "text": "Calibration of full fake sample\nWe now calibrate the entire fake sample. The computed parameters are used as ground truth for evaluation:\n\nfakeSampleCBICCalibration &lt;- calibrateBrainCharts(filter(brainChartsDFFake, study == \"HBNCBIC2\"), phenotype = phenotype)",
    "crumbs": [
      "BrainChart calibration - assessing accuracy of centile method"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Small sample, repeated measure, calibration with BrainChart",
    "section": "",
    "text": "Introduction\nThis site contains two tutorials explaining calibration using the method published in:\n\n\nInstallation\nThis software runs as as addon to the Braincharts software, which was written in R. In a shell, obtain the software from GitHub as follows:\n\ngit clone https://github.com/NCHADataPlatform/brainchartscentiles.git\ncd brainchartscentiles\ngit submodule init .\ngit submodule update\n\n\n\nR dependencies\nIn R, install the required packages for Braincharts:\n\ninstall.packages(c('gamlss', 'tidyverse'))\n\nThen install the dependencies for the example scripts on the github repository:\n\ninstall.packages(c('ggplot2', 'pracma'))\n\nThe previous two commands only need to be executed once.\nFor each R session, execute the following to import the software:\n\nsource('&lt;install directory&gt;/calibrate_braincharts_centiles.R')\n\n\n\nTutorial 1:\nThis is where you should start after installing the software\nCalibration tutorial\n\n\nTutorial 2:\nThis is minimal example of the procedures used to assess calibration accuracy as reported in the paper.\nAccuracy assessment",
    "crumbs": [
      "Overview"
    ]
  },
  {
    "objectID": "calibration_example.html",
    "href": "calibration_example.html",
    "title": "BrainChart calibration tutorial",
    "section": "",
    "text": "The code in this repository extends the original BrainChart codebase, and therefore can’t be assembled into a standard R package without restructuring that code.\nFirst, load the libraries we’ll be using later:\n\nlibrary(tidyverse)\nlibrary(pracma)\n\nThe functionality in this repository is accessed via the following code snippet.\n\nBrainChartFolder &lt;- dirname(normalizePath(\"calibrate_braincharts_centiles.R\"))\nwd &lt;- setwd(BrainChartFolder)\nsource(\"calibrate_braincharts_centiles.R\")\nsetwd(wd)\n\nIMPORTANT NOTE A full path to calibrate_braincharts_centiles.R must be provided if your code is outside this repository. e.g.\n\nBrainChartFolder &lt;- dirname(normalizePath(\"~/Projects/brainchartscentiles/calibrate_braincharts_centiles.R\"))\nsource(file.path(BrainChartFolder, 'calibrate_braincharts_centiles.R'))\n\nUsing the calibration functions requires the following steps:\n\nLoading brain IDPs\nAttaching demographic and site data\nRenaming columns\nCalibrating the large population sample\nCalibrate the small population sample with repeated measures in the large population sample\n\nThis tutorial illustrates calibration using a combination of data from the healthy brain network and synthetic data. The code can be used as a template to calibrate your own data.\nNote that some output from the code snippets has been supressed to make cleaner documentation. The code used to create this tutorial is available in the file calibration_example_hbn.R.",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#helper-function-and-loading-freesurfer-data",
    "href": "calibration_example.html#helper-function-and-loading-freesurfer-data",
    "title": "BrainChart calibration tutorial",
    "section": "Helper function and loading FreeSurfer data",
    "text": "Helper function and loading FreeSurfer data\nFirst load the study FreeSurfer data. These tables are collated from the individual study statistics using the FreeSurfer asegstats2table and aparcstats2table utilities, as illustrated in the bash script named freesurfer_make_stats.sh.\n\nreadFS &lt;- function(fname) {\n  df &lt;- read_csv(fname, name_repair = \"universal\", show_col_types = FALSE)\n  colnames(df)[1] &lt;- \"ID\"\n  return(df)\n}\n\nasegDF &lt;- readFS(file.path('HBN', 'stats_aseg.csv'))\nlhCortThicknessDF &lt;- readFS(file.path('HBN', 'stats_aparc_lh_thickness.csv'))\nlhCortSurfaceAreaDF &lt;- readFS(file.path('HBN', 'stats_aparc_lh_area.csv'))\nrhCortThicknessDF &lt;- readFS(file.path('HBN', 'stats_aparc_rh_thickness.csv'))\nrhCortSurfaceAreaDF &lt;- readFS(file.path('HBN', 'stats_aparc_rh_area.csv'))",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#set-up-idp-columns",
    "href": "calibration_example.html#set-up-idp-columns",
    "title": "BrainChart calibration tutorial",
    "section": "Set up IDP columns",
    "text": "Set up IDP columns\nNext, we select columns of interest and combine and rename them as required by the BrainChart calibration process. We then join the per-hemisphere surface-based metrics to the volume metrics and optionally discard columns not required by calibration.\n\n# make the IDP columns\nbrainChartsDF &lt;- select(asegDF, ID, \n                        CerebralWhiteMatterVol, \n                        SubCortGrayVol, CortexVol, \n                        EstimatedTotalIntraCranialVol, \n                        Left.Lateral.Ventricle, Right.Lateral.Ventricle, \n                        SupraTentorialVolNotVent, BrainSegVol.to.eTIV)\nbrainChartsDF &lt;- mutate(brainChartsDF, \n                        Ventricles = Left.Lateral.Ventricle + \n                          Right.Lateral.Ventricle, BrainSegVol.to.eTIV)\n\nbrainChartsDF &lt;- rename(brainChartsDF, \n                        WMV = CerebralWhiteMatterVol,\n                        sGMV = SubCortGrayVol,\n                        GMV = CortexVol,\n                        etiv = EstimatedTotalIntraCranialVol,\n                        TCV = SupraTentorialVolNotVent,\n                        )\n# join surface area measures\nbrainChartsDF &lt;- left_join(brainChartsDF, \n                           select(lhCortSurfaceAreaDF, ID, \n                                  lh_WhiteSurfArea_area), by=\"ID\")\nbrainChartsDF &lt;- left_join(brainChartsDF, \n                           select(rhCortSurfaceAreaDF, ID, \n                                  rh_WhiteSurfArea_area), by=\"ID\")\n# join cortical thickness measures\nbrainChartsDF &lt;- left_join(brainChartsDF, \n                           select(lhCortThicknessDF, ID, \n                                  lh_MeanThickness_thickness), by=\"ID\")\nbrainChartsDF &lt;- left_join(brainChartsDF, \n                           select(rhCortThicknessDF, ID, \n                                  rh_MeanThickness_thickness), by=\"ID\")\n\nbrainChartsDF &lt;- mutate(brainChartsDF, \n                        SA = lh_WhiteSurfArea_area + rh_WhiteSurfArea_area)\nbrainChartsDF &lt;- mutate(brainChartsDF, \n                        CT = ((lh_MeanThickness_thickness * \n                                 lh_WhiteSurfArea_area) + \n                                (rh_MeanThickness_thickness * \n                                   rh_WhiteSurfArea_area))/SA,\n                        fs_version = 'Custom_T1T2',\n                        run = 1,\n                        participant = ID,\n                        country = 'Australia',\n                        dx = 'CN'\n                        )\n\nbrainChartsDF &lt;- select(brainChartsDF, -Right.Lateral.Ventricle, \n                        -Left.Lateral.Ventricle, \n                        -ends_with(\"area\"), -ends_with(\"thickness\"))",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#set-up-other-required-columns",
    "href": "calibration_example.html#set-up-other-required-columns",
    "title": "BrainChart calibration tutorial",
    "section": "Set up other required columns",
    "text": "Set up other required columns\nHere, we make the columns fs_version (the version of FreeSurfer used for processing), run (an identifier for the acquisition session), participant (the subject IDs), country (acquisition country, unused).\n\nbrainChartsDF &lt;- mutate(brainChartsDF, \n                        fs_version = 'Custom_T1T2',\n                        run = 1,\n                        participant = ID,\n                        country = 'Australia',\n)",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#set-up-the-study-column",
    "href": "calibration_example.html#set-up-the-study-column",
    "title": "BrainChart calibration tutorial",
    "section": "Set up the study column",
    "text": "Set up the study column\nThe study column contains the identifier for the sample each set of measurements belongs to. It can be an arbitrary string, and all measurements belonging to the same sample must have the same value. It cannot be one of the studies in the Braincharts’ training set, which are as follows: 3R-BRAIN, ABCD, abide1, abide2, ADHD200, ADNI, AIBL, AOBA, AOMIC_ID1000, AOMIC_PIOP1, AOMIC_PIOP2, ARWIBO, BabyConnectome, BGSP, BHRCS, BSNIP, Calgary, CALM, CamCAN, CAMFT, Cornell_C1, Cornell_C2, cVEDA, devCCNP, dHCP, DLBS, EDSD, EMBARC, FemaleASD, FinnBrain, GUSTO, HABS, Harvard_Fetal1, HBN, HCP, HCP_lifespanA, HCP_lifespanD, IBIS, ICBM, IMAGEN, IMAP, IXI, LA5c, MCIC, Narratives, NHGRI, NIH, NIHPD, NSPN, NTB_Yale, OASIS3, Oulu, PCDC, PING, PNC, POND, PREVENTAD, RDB, SALD, SLIM, UCSD, UKB, VETSA, WAYNE.\nIn this example, we set the study column later via the demographic data.",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#set-up-the-diagnosisgroup-column",
    "href": "calibration_example.html#set-up-the-diagnosisgroup-column",
    "title": "BrainChart calibration tutorial",
    "section": "Set up the diagnosis/group column",
    "text": "Set up the diagnosis/group column\nThe dx column assigns participants to control CN (for calibration) or other notCN (not for calibration). Here, all subjects are controls, so we set it as follows:\n\nbrainChartsDF &lt;- mutate(brainChartsDF, \n                        dx = \"CN\"\n)\n\nDerived values, such as centiles, are estimated for non-controls, but these measurements are not used for calibration.",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#prepare-demographic-information",
    "href": "calibration_example.html#prepare-demographic-information",
    "title": "BrainChart calibration tutorial",
    "section": "Prepare demographic information",
    "text": "Prepare demographic information\nPreparing the demographic information is similar. In the HBN dataset the demographic tables are provided on a per-study basis, so we load them individually, create a study column, combine into a single table, create an age_days column and rename the Sex column and set up the factor levels. We set the study column according to the acquisition site (CBIC, CUNY, SI, HBNRU).\n\ndemoCBIC &lt;- read_csv(file.path('HBN', 'participants-CBIC.csv'), \n                     show_col_types = FALSE)\ndemoCUNY &lt;- read_csv(file.path('HBN', 'participants-CUNY.csv'), \n                     show_col_types = FALSE)\ndemoSI &lt;- read_csv(file.path('HBN', 'participants-SI.csv'), \n                   show_col_types = FALSE)\ndemoRU &lt;- read_csv(file.path('HBN', 'participants-RU.csv'), \n                   show_col_types = FALSE)\n\ndemoCBIC &lt;- mutate(demoCBIC, study = 'HBNCBIC')\ndemoCUNY &lt;- mutate(demoCUNY,study = 'HBNCUNY')\ndemoSI &lt;- mutate(demoSI, study = 'HBNSI')\ndemoRU &lt;- mutate(demoRU , study = 'HBNRU')\n\ndemoDF &lt;- bind_rows(demoCBIC, demoCUNY, demoSI, demoRU)\ndemoDF &lt;- mutate(demoDF, age_days = Age * 365.25)\ndemoDF &lt;- rename(demoDF, sex = Sex)\n\ndemoDF &lt;- mutate(demoDF, \n                 sex = factor(sex, labels = c(\"Male\", \"Female\"), \n                                      levels = c(0, 1)))",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#combining-idp-and-demographic-tables",
    "href": "calibration_example.html#combining-idp-and-demographic-tables",
    "title": "BrainChart calibration tutorial",
    "section": "Combining IDP and demographic tables",
    "text": "Combining IDP and demographic tables\nFinally, we merge the demographic and IDP tables using the study ID as a key, and exclude any incomplete records.\nMore complex studies may require merging by combinations of multiple columns, such as ID and time point or site.\n\nbrainChartsDF &lt;- left_join(brainChartsDF, \n                           select(demoDF, participant_id, sex, age_days, study), \n                           by=join_by(ID==participant_id))\n\n# remove mising values\nbrainChartsDF &lt;- na.omit(brainChartsDF)\nbrainChartsDF &lt;- mutate(brainChartsDF, study = factor(study, levels=c(\"HBNCBIC\", \"HBNCUNY\", \"HBNRU\", \"HBNSI\")))",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#study-overview",
    "href": "calibration_example.html#study-overview",
    "title": "BrainChart calibration tutorial",
    "section": "Study overview",
    "text": "Study overview\nPerform a quick check of study numbers and breakdown by sex to ensure that the data is correctly loaded\n\ncount(brainChartsDF, study)\n\n# A tibble: 4 × 2\n  study       n\n  &lt;fct&gt;   &lt;int&gt;\n1 HBNCBIC  1461\n2 HBNCUNY   569\n3 HBNRU     972\n4 HBNSI     341\n\ncount(brainChartsDF, study, sex, sort = FALSE)\n\n# A tibble: 8 × 3\n  study   sex        n\n  &lt;fct&gt;   &lt;fct&gt;  &lt;int&gt;\n1 HBNCBIC Male     938\n2 HBNCBIC Female   523\n3 HBNCUNY Male     353\n4 HBNCUNY Female   216\n5 HBNRU   Male     626\n6 HBNRU   Female   346\n7 HBNSI   Male     195\n8 HBNSI   Female   146",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#calibration-phase-1",
    "href": "calibration_example.html#calibration-phase-1",
    "title": "BrainChart calibration tutorial",
    "section": "Calibration, Phase 1",
    "text": "Calibration, Phase 1\nPhase 1 of calibration is the standard, cross sectional, version proposed in the original BrainCharts paper. We show cortical thickness as the IDP of interest. We perform this on a per-study basis, since each study represents a single sample. We will illustrate usage with a single site (CBIC).\n\nbrainChartsDF &lt;- filter(brainChartsDF, study == \"HBNCBIC\")\n# convert to dataframe for compatability with non-tidyverse code\nbrainChartsDF &lt;- data.frame(brainChartsDF)\nrow.names(brainChartsDF) &lt;- brainChartsDF$ID\n\nphenotype &lt;- \"CT\"\n\n# do the full sample calibrations per site\nfullSampleCBICCalibration &lt;- calibrateBrainCharts(\n  filter(brainChartsDF, study == \"HBNCBIC\"), phenotype = phenotype)\n\nThe results data structure will be described, this is purely for reference. The dataframe fullSampleCBICCalibration is the output\n\nfullSampleCBICCalibration$expanded: The model parameters\n\nfullSampleCBICCalibration$expanded$mu$ranef: The \\(\\mu\\) site-effect estimates. The user-provided study name will be the estimated effect for the sample, in this example it is fullSampleCBICCalibration$expanded$mu$ranef[['HBNCBIC']]\nfullSampleCBICCalibration$expanded$sigma$ranef: The \\(\\mu\\) site-effect estimates. The user-provided study name will be the estimated effect for the sample, in this example it is fullSampleCBICCalibration$expanded$mu$ranef[['HBNCBIC']]\n\nfullSampleCBICCalibration$DATA.PRED: The data with predicted values from the model before calibration\nfullSampleCBICCalibration$DATA.PRED2: The data with predicted values for parameters after calibration\n\nfullSampleCBICCalibration$DATA.PRED2$meanCT2transformed: the transformed cortical thickness values\nfullSampleCBICCalibration$DATA.PRED2$mu.wre: the estimated \\(\\mu\\) for each measurement\nfullSampleCBICCalibration$DATA.PRED2$sigma.wre: the estimated \\(\\sigma\\) for each measurement\nfullSampleCBICCalibration$DATA.PRED2$PRED.l250.wre: the estimated 0.25 centile for each measurement\nfullSampleCBICCalibration$DATA.PRED2$PRED.m500.wre: the estimated 0.5 (median) centile for each measurement\nfullSampleCBICCalibration$DATA.PRED2$PRED.u750.wre: the estimated 0.75 centile for each measurement",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  },
  {
    "objectID": "calibration_example.html#calibration-phase-2",
    "href": "calibration_example.html#calibration-phase-2",
    "title": "BrainChart calibration tutorial",
    "section": "Calibration, Phase 2",
    "text": "Calibration, Phase 2\nPhase 2 of calibration is the “small” sample calibration, which would typically form part of the study dataset. We generate a simulated small sample in this example.\n\nsubFakeCBIC &lt;- simulateSmallSite(fullSampleCBICCalibration, brainChartsDF)\n\nHere, subFakeCBIC would represent the “small” sample an investigator is wishing to calibrate. We calibrate this sample using the centile-informed repeated measures method, using the large site calibration output previously computed as follows:\n\nsubFakeCBICQuantileCalibration &lt;- \n  calibrateBrainChartsIDQuantilePenalty(subFakeCBIC, phenotype = \"CT\", \n                                        largeSiteOutput = fullSampleCBICCalibration)",
    "crumbs": [
      "BrainChart calibration tutorial"
    ]
  }
]